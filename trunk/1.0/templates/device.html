{% extends "base.html" %}
{% block add_css %}
    <!-- DataTables CSS -->
 <!--    <link href="/static/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.css" rel="stylesheet"> -->

{% endblock add_css %}

{% block page-wrapper %}

<div id="page-wrapper">
    <div class="col-lg-12">
        <div class="panel panel-default">				
		<div class="panel-body">  

			<form id='dev_form'>
				<div class="row"> 

             	<div class="col-lg-6" style="padding-left: 0">
                    <a href="/device_add" class="btn btn-sm btn-primary "> 添加资产 </a>
                </div>
                <div class="col-lg-6" style="padding-right: 0">
                             <div class="input-group">
                                <input type="text" class="form-control m-b input-sm" id="search_input" name="keyword" value="" placeholder="Search">
                                <input type="text" style="display: none">
                                <div class="input-group-btn">
                                    <button id='search_btn' href="" type="button" class="btn btn-sm btn-primary search-btn"  onclick="change_info()">
                                        - 搜索 -
                                    </button>
                                  <!--   <button type="button" href="" name="export" class="btn btn-sm btn-success search-btn-excel" onclick="return false">
                                        - 导出 -
                                    </button> -->
                                </div>
                            </div>
                </div>
            	</div>
				<div class="row">
                     <table class="table table-striped table-bordered table-hover">
						<thead>
							<tr>
								<th class="text-center">
                                    <input id="checkall" type="checkbox" class="i-checks" name="checkall" value="checkall" data-editable='false' onclick="check_all('dev_form')">
                                </th>
								<th>主机名</th>
								<!-- <th>IP</th> -->
								<th>CPU核数</th>
								<th>内存</th>
								<th>IP地址</th>
								<th>操作系统</th>
								<th>主机类型</th>
								<th>硬盘</th> 
								<th>IDC</th>
								<th>资产组</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
					
								
							{% for dev in devs %}  
								<tr class="gradeX">                                               
                                      	<td class="text-center" name="id" value="{{dev.info.id}}" data-editable='false'>
                                        <input name="id" value="{{dev.info.id}}" type="checkbox" class="i-checks">
                                    	</td>
                                      	<td><a href="/devdetail/{{dev.info.id}}/">{{dev.info.hostname}}</a></td>
                                      	<td>{{dev.info.cpunum}}</td>
                                      	<td>{{dev.info.mem}}</td>
                                      	<td>{{dev.info.ip}}</td>
                                      	<td>{{dev.info.os}}</td>
                                      	<td>{{dev.info.hyper}}</td>
                                      	<td>{{dev.info.disk}}</td>
                                      	<td>
                                        {%for g in dev.group%}
                                        {{g}}</br>
                                        {%endfor%}
                                        </td>
                                      	<td>
                                        {%for i in dev.idc%}
                                        {{i}}</br>
                                        {%endfor%}
                                        </td>
									
                                        <td class="text-center" data-editable='false'>
                                        <a href="/device_edit/{{dev.info.id}}/" class="btn btn-xs btn-info">编辑</a>
                                        <a href="" class="btn btn-xs btn-warning">连接</a>
                                        <a value="/device_del/?id={{dev.info.id}}" class="btn btn-xs btn-danger asset_del">删除</a>
                                   		</td>
                                </tr>
                           {%endfor%}      
                              
						</tbody>
                    </table>
				</div>
				<div class="row">
                <div class="col-lg-6" style="padding-left: 0">
                                <input type="button" id="asset_del" class="btn btn-danger btn-sm"  name="del_button" value="删除"/>
                                <a value="" type="button" class="btn btn-sm btn-warning iframe">修改</a>
                                <input type="button" id="asset_update" class="btn btn-info btn-sm"  name="update_button" value="更新"/>
                               <!-- <input type="button" id="asset_update_all" class="btn btn-primary btn-sm"  name="update_button" value="更新全部"/> -->
                                <input type="button" id="exec_cmd" class="btn btn-sm btn-primary"  name="exec_cmd" value="执行命令"/>
                </div>
				</div>
			</form>
		</div>
	</div>
	</div>
</div>
	
{% endblock page-wrapper %}


{% block add_script %}

<script>
function getIDall() {
    var check_array = [];
    $(".gradeX input:checked").each(function () {

        var id = $(this).attr("value");
        // alert(id);
        check_array.push(id);
    });
    // alert(check_array);
    return check_array.join(",");

}
$(document).ready(function(){
    $('.asset_del').click(function(){
            var row = $(this).closest('tr');
            if (confirm("确定删除?")) {
                $.get(
                        $(this).attr('value'),
                        {},
                        function (data) {
                            row.remove()
                        }
                )
            }
        });


    $('#asset_del').click(function () {
        var asset_id_all = getIDall();
        if (asset_id_all == ''){
            alert("请至少选择一行!");
            return false;
        }
        if (confirm("确定删除?")) {
            $.ajax({
                type: "post",
                data: {asset_id_all: asset_id_all},
                url: "/device_del",
                success: function () {
                    parent.location.reload();
                }
            });
        }
    });
});
//此函数用于checkbox的全选和反选
var checked=false;
function check_all(form) {
    var checkboxes = document.getElementById(form);
    if (checked == false) {
        checked = true
    } else {
        checked = false
    }
    for (var i = 0; i < checkboxes.elements.length; i++) {
        if (checkboxes.elements[i].type == "checkbox") {
            checkboxes.elements[i].checked = checked;
        }
    }
}

function checkAll(id, name){
    var checklist = document.getElementsByName(name);
    if(document.getElementById(id).checked)
        {
        for(var i=0;i<checklist.length;i++)
        {
          checklist[i].checked = 1;
        }
    }else{
        for(var j=0;j<checklist.length;j++)
        {
         checklist[j].checked = 0;
        }
    }
}
</script>
{% endblock add_script %}
